(function(){var a=[];function d(){var g=0;for(g=0;g<a.length;g++){a[g].pause();a[g].updateDisplay()}}function e(i,h){var g=h-i.toString().length+1;return new Array(+(g>0&&g)).join("0")+i}function b(h){if(isNaN(h)){return"--:--"}var g=Math.floor(h/60);h=h-g*60;return e(g,2)+":"+e(h,2)}function c(g){g=decodeURI(g);return g.split("/").pop().split(".").shift()}var f=function(g){this.bbplayer=g;this.bbaudio=g.find("audio");this.bbdebug=g.find(".bb-debug");this.bbaudio.get(0).preload="auto";this.state="paused";this.trackList=[];this.init()};f.prototype.log=function(g){if(this.bbdebug){this.bbdebug.append(g+"<br>");this.bbdebug.scrollTop(this.bbdebug.prop("scrollHeight")-this.bbdebug.height())}};f.prototype.canPlay=function(h){var g=this.bbaudio.get(0);if((/mp3/i).test(h)&&g.canPlayType("audio/mpeg")){return true}if((/ogg/i).test(h)&&g.canPlayType("audio/ogg")){return true}return false};f.prototype.loadSources=function(){var g=this;g.log("func: loadSources");g.bbaudio.find("source").each(function(h){var m=$(this).attr("src").split("/").pop();var l=m.split(".").pop();var j=m.split(".").shift();var k=g.canPlay(l);var i=g.bbaudio.get(0);if($.inArray(j,g.trackList)===-1&&k===true){g.trackList.push(j)}else{$(this).remove()}})};f.prototype.updateDisplay=function(){var h=this.bbaudio.get(0);var i=b(Math.ceil(h.duration));var g=b(Math.ceil(h.currentTime));var j=c(h.currentSrc);this.bbplayer.find(".bb-trackLength").html(i);this.bbplayer.find(".bb-trackTime").html(g);this.bbplayer.find(".bb-trackTitle").html(j)};f.prototype.loadTrack=function(g){var h=this.bbaudio.find("source").eq(g).attr("src");this.bbaudio.get(0).src=h;this.currentTrack=g;this.log("func: loadTrack: loaded "+h)};f.prototype.loadNext=function(){this.log("func: loadNext");var h=this.bbaudio.find("source").length;var g=((1+this.currentTrack)%h);this.loadTrack(g)};f.prototype.loadPrevious=function(){this.log("func: loadPrevious");var h=this.bbaudio.find("source").length;var g=(this.currentTrack+(h-1))%h;this.loadTrack(g)};f.prototype.setAudioEventHandlers=function(){var g=this;g.log("func: setAudioEventHandlers");g.bbaudio.on("abort",function(){g.log("event: audio abort")});g.bbaudio.on("canplay",function(){g.log("event: audio canplay");if(g.state==="playing"&&$(this).get(0).paused){$(this).get(0).play()}g.updateDisplay()});g.bbaudio.on("canplaythrough",function(){g.log("event: audio canplaythrough")});g.bbaudio.on("durationchange",function(){g.log("event: audio durationchange")});g.bbaudio.on("emptied",function(){g.log("event: audio emptied")});g.bbaudio.on("ended",function(){g.log("event: audio ended");g.loadNext()});g.bbaudio.on("error",function(){g.log("event: audio error")});g.bbaudio.on("loadeddata",function(){g.log("event: audio loadeddata")});g.bbaudio.on("loadedmetadata",function(){g.log("event: audio loadedmetadata")});g.bbaudio.on("loadstart",function(){g.log("event: audio loadstart")});g.bbaudio.on("pause",function(){g.log("event: audio pause")});g.bbaudio.on("play",function(){g.log("event: audio play")});g.bbaudio.on("playing",function(){g.log("event: audio playing")});g.bbaudio.on("progress",function(){g.log("event: audio progress")});g.bbaudio.on("ratechange",function(){g.log("event: audio ratechange")});g.bbaudio.on("seeked",function(){g.log("event: audio seeked")});g.bbaudio.on("seeking",function(){g.log("event: audio seeking")});g.bbaudio.on("stalled",function(){g.log("event: audio stalled")});g.bbaudio.on("suspend",function(){g.log("event: audio suspend")});g.bbaudio.on("timeupdate",function(){g.updateDisplay()});g.bbaudio.on("volumechange",function(){g.log("event: audio volumechange")});g.bbaudio.on("waiting",function(){g.log("event: audio waiting")})};f.prototype.play=function(){d();var g=this;g.log("func: play");g.bbaudio.get(0).play();g.state="playing";var h=g.bbplayer.find(".bb-play");h.removeClass("bb-paused");h.addClass("bb-playing")};f.prototype.pause=function(){this.log("func: pause");this.bbaudio.get(0).pause();this.state="paused";var g=this.bbplayer.find(".bb-play");g.removeClass("bb-playing");g.addClass("bb-paused")};f.prototype.setClickHandlers=function(){var h=this;h.log("func: setClickHandlers");var g=h.bbaudio.get(0);h.bbplayer.find(".bb-forward").click(function(){h.log("event: click .bb-forward");h.loadNext()});h.bbplayer.find(".bb-play").click(function(){h.log("event: click .bb-play");if(h.state==="paused"){h.play()}else{h.pause()}h.updateDisplay()});h.bbplayer.find(".bb-rewind").click(function(){h.log("event: click .bb-rewind");var i=g.currentTime;if(i>1.5){g.currentTime=0}else{h.loadPrevious()}});if(h.bbdebug){h.bbdebug.click(function(){$(this).empty()})}};f.prototype.init=function(){var g=this;g.setAudioEventHandlers();g.loadSources();g.currentTrack=0;g.setClickHandlers();g.updateDisplay()};$(document).ready(function(){$(".bbplayer").each(function(g){a[g]=new f($(this))})})}());